var embryo_options={cstrName:"init",cstrArrayName:"_types",forceCstr:true,nameType:"_type",forceTyping:true,typeDefault:"Embryo",nameProperties:"properties",nameBlacklist:"_blacklist",deleteBlacklist:true};var embryo_plugins=[];var embryo_types=[];var debugPlugin=function(e,t,n){console.log("["+e+"] - "+t);console.log("	type: ",n._type);var n=n.prototype||n;for(var e in n){if(n.hasOwnProperty(e)){var r=n[e];var i=typeof r;switch(i){case"function":i=r.toString().replace(/\n/g,"");i=i.replace(/\s+/g," ");break;case"object":i=JSON.stringify(r);break;default:i=r;break}console.log("	property: ["+e+"]:		["+i+"] -> ("+typeof r+")")}}};var isTypeExist=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.name==t){return true}}return false};var Embryo=function(){var e=[];for(var t=0;t<embryo_types.length;t++){var n=embryo_types[t];if(this instanceof n.child){e.push(n)}}for(var t=e.length-1;t>-1;t--){var n=e[t];var r=n.props;if(r){for(var i in r){if(r.hasOwnProperty(i)){if(typeof this[i]=="undefined"){this[i]=r[i]}}}}}for(var t=0;t<e.length;t++){var n=e[t];var s=n.init;if(s){s.apply(this,arguments)}}};Embryo.version="0.1.1";Embryo.extend=function(e){var t=e[embryo_options.cstrName]||null;if(embryo_options.forceCstr&&!t){if(!t){throw Error("No constructor function found.")}}if(t&&typeof t!=="function"){throw Error("Constructor function invalid.")}var n=this;var r=function(){return n.apply(this,arguments)};r.extend=n.extend;var i=function(){};i.prototype=this.prototype;r.prototype=new i;if(embryo_options.forceTyping&&!e[embryo_options.nameType]){e[embryo_options.nameType]=embryo_options.typeDefault}var s=e[embryo_options.nameType];for(var o=0;o<embryo_plugins.length;o++){var u=embryo_plugins[o];var a=u.isDebug()?debugPlugin:null;e=u.exec(e,a,r)}for(var f in e){if(f==embryo_options.nameBlacklist&&embryo_options.deleteBlacklist){continue}if(f==embryo_options.nameProperties){continue}if(f==embryo_options.cstrName){if(!isTypeExist(embryo_types,s)){embryo_types.push({name:s,init:e[f]||null,props:e[embryo_options.nameProperties],child:r})}}r.prototype[f]=e[f]}return r};Embryo.configure=function(e){for(var t in e){if(e.hasOwnProperty(t)){embryo_options[t]=e[t]}}};Embryo.use=function(e,t){e.configure(embryo_options);e.setDebug(t);embryo_plugins.push(e)};Embryo.plugins=function(e){for(var t=0;t<embryo_plugins.length;t++){var n=embryo_plugins[t];if(n.name==e){return n}}return null};Embryo.configure();Embryo.Plugin=Embryo.extend({_type:"Plugin",name:"Plugin",options:null,init:function(e){this.setDebug(e)},configure:function(e){for(var t in e){if(e.hasOwnProperty(t)){this.options[t]=e[t]}}},isBlacklisted:function(e){var t=e["_blacklist"]||false;if(!t){return false}for(var n=0;n<t.length;n++){var r=t[n];if(r==this.name||r=="*"){return true}}return false},isDebug:function(){return this.debug},setDebug:function(e){this.debug=e||false},getName:function(){return this.name}});var Attribute=Embryo.Plugin.extend({_type:"Attribute",name:"Attribute",options:{getPrefix:"get",setPrefix:"set",camelize:false},init:function(){},exec:function(e,t,n){if(this.isBlacklisted(e)){t&&console.log("["+this.name+"] - SKIPPED");return e}t&&t(this.name,"BEFORE",e);var r=e[this.options.nameProperties]||{};for(var i in r){if(r.hasOwnProperty(i)){var s=r[i];if(typeof s!=="function"){var o=this.options.camelize?this.camelize(i):i;var u=this.options.getPrefix+o;this.defineGetter(e,u,i);o=this.options.camelize?this.camelize(i):i;u=this.options.setPrefix+o;this.defineSetter(e,u,i)}}}t&&t(this.name,"AFTER",e);return e},defineGetter:function(e,t,n){e[t]=function(){return this[n]}},defineSetter:function(e,t,n){e[t]=function(e){this[n]=e}},camelize:function(e){e=e.toLowerCase();e=e.charAt(0).toUpperCase()+e.slice(1);return e}});var BeforeAfter=Embryo.Plugin.extend({name:"BeforeAfter",options:{beforePrefix:"-",afterPrefix:"+",hiddenPrefix:"_pm_"},init:function(){},exec:function(e,t,n){if(this.isBlacklisted(e)){t&&console.log("["+this.name+"] - SKIPPED");return e}t&&t(this.name,"BEFORE",e);var r={};var i=this.options.beforePrefix;var s=this.options.afterPrefix;for(var o in e){if(e.hasOwnProperty(o)){var u=e[o];var a="";var f=null;if(typeof u=="function"){if(o.indexOf(s)>-1){a=o.replace(s,"");f=r[a];if(!f){f=r[a]={before:false,after:false}}f.after=true}else if(o.indexOf(i)>-1){a=o.replace(i,"");f=r[a];if(!f){f=r[a]={before:false,after:false}}f.before=true}}}}for(var l in r){if(r.hasOwnProperty(l)){var c=r[l];this.defineMethod(e,l,c.before,c.after)}}t&&t(this.name,"AFTER",e);return e},defineMethod:function(e,t,n,r){if(!e[t]){throw new Error("method "+t+" not found.")}var i=this.options.hiddenPrefix+t;var s=this.options.beforePrefix+t;var o=this.options.afterPrefix+t;e[i]=e[t];if(n&&r){e[t]=function(){this[s].apply(this,arguments);this[i].apply(this,arguments);this[o].apply(this,arguments)}}else if(n){e[t]=function(){this[s].apply(this,arguments);this[i].apply(this,arguments)}}else{e[t]=function(){this[i].apply(this,arguments);this[o].apply(this,arguments)}}}});var Surcharge=Embryo.Plugin.extend({name:"Surcharge",options:{suffix:"|",hiddenPrefix:"_pm_"},methods:[],init:function(){},exec:function(e,t,n){if(this.isBlacklisted(e)){t&&console.log("["+this.name+"] - SKIPPED");return e}t&&t(this.name,"BEFORE",e);var r=this.options.suffix;this.methods=[];for(var i in e){if(e.hasOwnProperty(i)){if(typeof e[i]=="function"){if(i.indexOf(r)>-1){parts=i.split(r);var s=parts[0];if(s){if(!this.isMethodExist(s)){this.methods.push(s)}}}}}}for(var o=0;o<this.methods.length;o++){this.defineMethod(e,this.methods[o])}t&&t(this.name,"AFTER",e);return e},isMethodExist:function(e){for(var t=0;t<this.methods.length;t++){if(this.methods[t]==e){return true}}return false},defineMethod:function(e,t){var n=this.options.hiddenPrefix;var r=n+t;var i=this.options.suffix;e[r]=e[t];e[t]=function(){var e=t+i+arguments.length;if(!this[e]){e=n+t;if(!this[e]){throw new Error('method "'+e+'" not defined.')}}this[e].apply(this,arguments)}}});var Memory=Embryo.Plugin.extend({name:"Memory",options:{nameInstanceArray:"instances",nameNewMethod:"new",nameStatsMethod:"stats",nameDestroyMethod:"destroy"},methods:[],init:function(){},exec:function(e,t,n){if(this.isBlacklisted(e)){t&&console.log("["+this.name+"] - SKIPPED");return e}t&&t(this.name,"BEFORE",e);e[this.options.nameInstanceArray]=[];e[this.options.nameNewMethod]=function(e,t){var n=t?new e(t):new e;this.instances.push(n);return n};e[this.options.nameStatsMethod]=function(){};e[this.options.nameDestroyMethod]=function(){for(var e=0;e<this.instances.length;e++){delete this.instances[e]}this.instances=[]};t&&t(this.name,"AFTER",e);return e}});var attributePlugin=new Attribute;attributePlugin.configure({getPrefix:"get",setPrefix:"set",camelize:true});var beforeAfterPlugin=new BeforeAfter;beforeAfterPlugin.configure({beforePrefix:"-",afterPrefix:"+",hiddenPrefix:"_bah_"});var surchargePlugin=new Surcharge;surchargePlugin.configure({suffix:"|",hiddenPrefix:"_pm_"});var memoryPlugin=new Memory;memoryPlugin.configure({nameInstanceArray:"instances",nameNewMethod:"new",nameStatsMethod:"stats",nameDestroyMethod:"destroy"});Embryo.configure({cstrName:"init",cstrArrayName:"_types",forceCstr:true,nameType:"_type",forceTyping:true,typeDefault:"Embryo",nameProperties:"properties",nameBlacklist:"_blacklist",deleteBlacklist:true});Embryo.use(attributePlugin,false);Embryo.use(beforeAfterPlugin,false);Embryo.use(surchargePlugin,false);Embryo.use(memoryPlugin,false)